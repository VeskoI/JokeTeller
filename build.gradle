// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:1.2.3'

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

allprojects {
    repositories {
        jcenter()
    }
}

task testLocally() {
    doLast {
        println "--- Tests passed, everything is awesome :) (see REPORTS folders for more details)"
    }
}

afterEvaluate {
    def startAppengineTask = tasks.findByPath(":backend:appengineRun")
    def unitTests = tasks.findByPath(":jokerlib:test")
    def androidTests = tasks.findByPath(":app:connectedAndroidTest")
    def stopAppengine = tasks.findByPath(":backend:appengineStop")

    testLocally.dependsOn startAppengineTask
    testLocally.dependsOn unitTests
    testLocally.dependsOn androidTests
    testLocally.finalizedBy stopAppengine

    unitTests.mustRunAfter startAppengineTask
    androidTests.mustRunAfter unitTests
}